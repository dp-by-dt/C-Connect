{% extends "base.html" %}


{% block extra_css %}
<style>
.delete-btn {
    transition: all 0.2s ease;
}

.delete-btn:hover {
    background-color: var(--danger-color);
    color: white;
    transform: translateY(-1px);
}

</style>
{% endblock %}

{% block body %}
<div class="container py-4">
    <div class="posts-header animate-on-scroll">
        <h1 class="posts-title">
            <i class="bi bi-rss me-2" style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
            Campus Feed
        </h1>
        <p class="posts-subtitle">Posts count: {{ posts|length }}</p>
    </div>

    <!-- Create Post Form -->
    <div class="section-card glass-card mb-4">
        <form method="POST" action="{{ url_for('posts.create_post') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">  
            <textarea name="content" rows="3" class="form-control mb-3" placeholder="What's happening?" required></textarea>
            <button type="submit" class="btn btn-primary-custom">Post</button>
        </form>
    </div>

    <hr>

    <!-- Posts List -->
    {% for post in posts %}
    <div class="section-card glass-card mb-3 animate-on-scroll">
        <div class="post-header">
            <strong>{{ post.user.username }}</strong>  <!-- Changed from post.user.name -->
            <small class="text-muted">{{ to_ist(post.created_at).strftime("%d %b %H:%M") }}</small>
        </div>
        <p class="post-content">{{ post.content }}</p>
        
        <!-- Like Form -->
        <form method="POST" action="{{ url_for('posts.toggle_like', post_id=post.id) }}" class="d-inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> 
            <button type="submit" class="btn btn-sm btn-outline-custom">
                {% if post.id in liked_post_ids %}
                    ‚ù§Ô∏è Unlike
                {% else %}
                    ü§ç Like
                {% endif %}
            </button>
            <span class="ms-2">{{ post.likes|length }} likes</span>
        </form>

        <!-- For deleting the own posts -->
        {% if post.user_id == current_user.id %}
        <form method="POST" action="{{ url_for('posts.delete_post', post_id=post.id) }}" class="d-inline ms-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-sm btn-outline-danger delete-btn" 
                    onclick="return confirm('Are you sure you want to delete this post?')">
                <i class="bi bi-trash"></i> Delete
            </button>
        </form>
        {% endif %}

    </div>
    {% endfor %}

    <!-- Pagination -->
    <div class="pagination">
        {% if pagination.has_prev %}
            <a href="{{ url_for('posts.feed', page=pagination.prev_num) }}" class="page-link">Prev</a>
        {% endif %}
        {% if pagination.has_next %}
            <a href="{{ url_for('posts.feed', page=pagination.next_num) }}" class="page-link">Next</a>
        {% endif %}
    </div>
</div>
{% endblock %}
