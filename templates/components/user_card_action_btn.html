<!-- ==================== USER CARD ACTION BUTTONS ====================
     Reusable action buttons for different connection states
     Used in: User cards, profile pages, connection lists
     ================================================================= -->

<style>
/* ===== Action Button Styles ===== */
.action-btn {
    padding: 0.625rem 1.25rem;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    border: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    white-space: nowrap;
}

/* Primary Action (Connect, Accept) */
.action-btn--primary {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    color: white;
}

.action-btn--primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

/* Success State (Connected) */
.action-btn--success {
    background: var(--success-color);
    color: white;
}

/* Danger Action (Reject, Remove) */
.action-btn--danger {
    background: transparent;
    color: var(--danger-color);
    border: 1px solid var(--danger-color);
}

.action-btn--danger:hover:not(:disabled) {
    background: var(--danger-color);
    color: white;
}

/* Warning Action (Cancel) */
.action-btn--warning {
    background: transparent;
    color: var(--warning-color);
    border: 1px solid var(--warning-color);
}

.action-btn--warning:hover:not(:disabled) {
    background: var(--warning-color);
    color: white;
}

/* Secondary Action */
.action-btn--secondary {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
}

.action-btn--secondary:hover:not(:disabled) {
    background: var(--bg-hover);
    color: var(--primary-color);
    border-color: var(--primary-color);
}

/* Disabled State */
.action-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Small Size */
.action-btn--sm {
    padding: 0.5rem 1rem;
    font-size: 0.8125rem;
}

/* Button Icons */
.action-btn i {
    font-size: 1rem;
}

/* Loading Spinner */
.action-btn__spinner {
    display: inline-block;
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: currentColor;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Button Group */
.action-btn-group {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}
</style>

<!-- ===== BUTTON MARKUP BASED ON CONNECTION STATUS ===== -->

{% if connection_status == 'accepted' %}
    <!-- Connected State - Disabled Success Button -->
    <button class="action-btn action-btn--success action-btn--sm" disabled>
        <i class="bi bi-check-circle-fill"></i>
        <span>Connected</span>
    </button>

{% elif connection_status == 'pending' and incoming_request %}
    <!-- Incoming Request - Accept/Reject Options -->
    <div class="action-btn-group">
        <button class="action-btn action-btn--primary action-btn--sm action-accept" 
                data-conn-id="{{ connection_id }}">
            <i class="bi bi-check2"></i>
            <span>Accept</span>
        </button>
        <button class="action-btn action-btn--danger action-btn--sm action-reject" 
                data-conn-id="{{ connection_id }}">
            <i class="bi bi-x"></i>
            <span>Reject</span>
        </button>
    </div>

{% elif connection_status == 'pending' %}
    <!-- Outgoing Request - Cancel Option -->
    <button class="action-btn action-btn--warning action-btn--sm action-cancel" 
            data-conn-id="{{ connection_id }}">
        <i class="bi bi-x-circle"></i>
        <span>Cancel Request</span>
    </button>

{% else %}
    <!-- No Connection - Send Request -->
    <button class="action-btn action-btn--primary action-btn--sm action-connect" 
            data-user-id="{{ user.id }}">
        <i class="bi bi-person-plus"></i>
        <span>Connect</span>
    </button>
{% endif %}

<!-- ===== JAVASCRIPT FOR ACTION BUTTONS ===== -->
<script>
(function() {
    // Accept connection request
    document.addEventListener('click', function(e) {
        if (e.target.closest('.action-accept')) {
            e.preventDefault();
            const button = e.target.closest('.action-accept');
            const connId = button.dataset.connId;
            
            // Show loading state
            const originalHTML = button.innerHTML;
            button.innerHTML = '<span class="action-btn__spinner"></span> Accepting...';
            button.disabled = true;
            
            // Get CSRF token
            const csrfToken = document.querySelector('input[name="csrf_token"]')?.value;
            
            fetch(`/connections/accept/${connId}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    window.cconnect.showToast(data.message || 'Connection accepted!', 'success');
                    // Optionally reload or update UI
                    setTimeout(() => location.reload(), 1000);
                } else {
                    window.cconnect.showToast(data.message || 'Failed to accept', 'danger');
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }
            })
            .catch(() => {
                window.cconnect.showToast('Network error occurred', 'danger');
                button.innerHTML = originalHTML;
                button.disabled = false;
            });
        }
    });
    
    // Reject connection request
    document.addEventListener('click', function(e) {
        if (e.target.closest('.action-reject')) {
            e.preventDefault();
            const button = e.target.closest('.action-reject');
            const connId = button.dataset.connId;
            
            // Show loading state
            const originalHTML = button.innerHTML;
            button.innerHTML = '<span class="action-btn__spinner"></span> Rejecting...';
            button.disabled = true;
            
            const csrfToken = document.querySelector('input[name="csrf_token"]')?.value;
            
            fetch(`/connections/reject/${connId}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    window.cconnect.showToast(data.message || 'Connection rejected', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    window.cconnect.showToast(data.message || 'Failed to reject', 'danger');
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }
            })
            .catch(() => {
                window.cconnect.showToast('Network error occurred', 'danger');
                button.innerHTML = originalHTML;
                button.disabled = false;
            });
        }
    });
    
    // Cancel connection request
    document.addEventListener('click', function(e) {
        if (e.target.closest('.action-cancel')) {
            e.preventDefault();
            const button = e.target.closest('.action-cancel');
            const connId = button.dataset.connId;
            
            const originalHTML = button.innerHTML;
            button.innerHTML = '<span class="action-btn__spinner"></span> Cancelling...';
            button.disabled = true;
            
            const csrfToken = document.querySelector('input[name="csrf_token"]')?.value;
            
            fetch(`/connections/cancel/${connId}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    window.cconnect.showToast(data.message || 'Request cancelled', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    window.cconnect.showToast(data.message || 'Failed to cancel', 'danger');
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }
            })
            .catch(() => {
                window.cconnect.showToast('Network error occurred', 'danger');
                button.innerHTML = originalHTML;
                button.disabled = false;
            });
        }
    });
    
    // Send connection request
    document.addEventListener('click', function(e) {
        if (e.target.closest('.action-connect')) {
            e.preventDefault();
            const button = e.target.closest('.action-connect');
            const userId = button.dataset.userId;
            
            const originalHTML = button.innerHTML;
            button.innerHTML = '<span class="action-btn__spinner"></span> Connecting...';
            button.disabled = true;
            
            const csrfToken = document.querySelector('input[name="csrf_token"]')?.value;
            
            fetch(`/connections/send/${userId}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    window.cconnect.showToast(data.message || 'Connection request sent!', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    window.cconnect.showToast(data.message || 'Failed to send request', 'danger');
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }
            })
            .catch(() => {
                window.cconnect.showToast('Network error occurred', 'danger');
                button.innerHTML = originalHTML;
                button.disabled = false;
            });
        }
    });
})();
</script>